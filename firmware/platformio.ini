; ============================================================
; platformio.ini
; PPF Workshop Monitoring System — ESP32 Firmware
; Board: Olimex ESP32-GATEWAY (LAN8720 Ethernet)
; ============================================================

[platformio]
default_envs = esp32-gateway-eth

; ─── Primary: Olimex ESP32-GATEWAY with Ethernet ─────────────────────────────
[env:esp32-gateway-eth]
platform    = espressif32
board       = esp32dev
framework   = arduino

; Board-specific flash/RAM
board_build.partitions = default.csv

; Serial monitor
monitor_speed  = 115200
monitor_filters = esp32_exception_decoder

; Build flags
; USE_ETHERNET: use LAN8720 Ethernet (reliable for factory)
; If you want WiFi instead, comment out USE_ETHERNET and uncomment USE_WIFI
build_flags =
    ; -DUSE_ETHERNET          ; ← disabled: no Ethernet cable in testing setup
    -DUSE_WIFI                ; ← WiFi mode for testing (captive portal via WiFiManager)
    -DSENSOR_DHT22_ONLY       ; ← testing PCB has only DHT22 — skips PMS5003 warmup
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM=0

; Libraries
lib_deps =
    ; Sensors
    adafruit/DHT sensor library @ ^1.4.4
    adafruit/Adafruit Unified Sensor @ ^1.1.14
    adafruit/Adafruit BME680 Library @ ^2.0.4
    ; MQTT
    knolleary/PubSubClient @ ^2.8.0
    ; JSON
    bblanchon/ArduinoJson @ ^6.21.5
    ; NTP
    arduino-libraries/NTPClient @ ^3.2.1
    ; WiFi provisioning — captive portal, credentials saved to NVS flash
    tzapu/WiFiManager @ ^2.0.17

upload_speed  = 115200
upload_port   = COM7          ; Silicon Labs CP210x — ESP32 testing PCB


; ─── Alternate: WiFi only (for dev/testing without Ethernet) ─────────────────
[env:esp32-wifi]
platform    = espressif32
board       = esp32dev
framework   = arduino

monitor_speed = 115200
monitor_filters = esp32_exception_decoder

build_flags =
    -DUSE_WIFI
    -DCORE_DEBUG_LEVEL=3

lib_deps =
    adafruit/DHT sensor library @ ^1.4.4
    adafruit/Adafruit Unified Sensor @ ^1.1.14
    adafruit/Adafruit BME680 Library @ ^2.0.4
    knolleary/PubSubClient @ ^2.8.0
    bblanchon/ArduinoJson @ ^6.21.5
    arduino-libraries/NTPClient @ ^3.2.1
    tzapu/WiFiManager @ ^2.0.17

upload_speed = 921600
